---
title: "Ejemplo Anova"
author: "Julio Zainea"
date: "20 de marzo de 2020"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(dplyr)
require(foreign)
library(ggplot2)
library(lmtest)
library(car)
library(ggfortify)
library(agricolae)
```

## Ejemplo 

Para nuestro ejemplo usaremos una base de datos que tiene información sociodemográfica de 173 países del mundo, tendremos en cuenta las variables "continent"  y "employrate", nuestro interés será verificar si hay diferencias en las tasas de empleo medio categorizando los continentes. 

Primero cargaremos las librerías necesarias y cargaremos la base de datos

```{r}
data.world <- read.csv2("https://raw.githubusercontent.com/shhschilling/statistikUmweltingenieure/master/data/gapC.csv",sep=",",dec=".")
data.world=data.world[complete.cases(data.world$employrate),]
data.world=data.frame(data.world)
attach(data.world)
names(data.world)
```

Nuestro problema es tomar la decisión frente a la siguiente prueba de hipótesis
$$
H_0: \mu_{AF}=\mu_{EE}=\mu_{WE}=\mu_{OC}=\mu_{AS}=\mu_{LATAM}=\mu_{NORAM}\\
H_a: al menos una es diferente a las demás
$$
Inicialmente veremos el comportamiento de manera descriptiva.


```{R}
boxplot(employrate~continent,data=data.world,
        col=rainbow(7,alpha=0.3),
        border=rainbow(7,v=0.9),boxwex=0.5,
        xlab="",ylab="",
        main="Tasa de empleo",las=2)
```


```{r}
aggregate(data.world$employrate,by=list(data.world$continent),mean)

```

Ahora haremos el anova

```{r}
anova=aov(employrate~continent,data=data.world )
summary(anova)
```
Antes de concluir debemos verificar los supuestos del modelo los cuales son:
## Normalidad
Para las pruebas tenemos que,

$$
H_0: \texttt{Los datos son normales}\\
H_a: \texttt{Los datos no son normales}
$$



```{r}
errores=residuals(anova)
shapiro.test(errores)

df <- data.frame(y =errores)
p <- ggplot(df, aes( sample=y))
p + stat_qq() + stat_qq_line()+xlab("Teoricos")+ylab("Observados")
caja=boxplot(errores,col=rgb(0.3,0.5,0.9,0.3),boxwex=0.5,border=rgb(0.3,0.5,0.9,1))
```

## Homocedasticidad
$$
H_0: \texttt{Los datos son Homocedasticos} \\
H_a: \texttt{Los datos son Heterocedasticos}
$$


```{r}
#bptest(errores~continent)
bartlett.test(errores ~continent)
leveneTest(errores~ continent)

ee=sqrt(abs(rstandard(anova)))
yest=predict(anova)
df=data.frame(ee,yest)

ggplot(df,aes(x=yest,y=ee))+geom_point()+xlab(expression("Predichos"))+ylab(expression(sqrt("Errores estandarizados")))+
  geom_smooth(se=F,method = 'loess')

```

## Independencia

$$
H_0: \texttt{Los errores son independientes}\\
H_a: \texttt{Los errores son dependientes}
$$

```{r}

dwtest(anova)
autoplot(acf(anova$residuals, plot = FALSE))
```


## Comparaciones múltiples


Ahora nuestro interés será determinar y caracterizar el comportamiento de las tasas de empleo por continente, es decir saber cual es el orden de los continentes teniendo en cuenta a esa variable. Para esto usaremos los test de comparaciones múltiples

```{r}
LSD.compa=LSD.test(anova,"continent",alpha = 0.05)
print(LSD.compa)
plot(LSD.compa,variation = "SD")
```


```{r}
HSD.compa=HSD.test(anova,"continent",alpha = 0.05)
print(HSD.compa)
plot(HSD.compa,variation = "SD")
```

## Ejercicio 

1. Investigar y realizar las comparaciones múltiples usando el método de Dunnett y el de Bonferroni  para nuestro ejemplo.

2. Investigar las diferencias entre los métodos de comaraciones múltiples